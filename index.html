<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orçamento e Recibo Elite Car</title>
<style>
  body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 20px; }
  h1, h2 { text-align: center; }
  form { max-width: 700px; margin: 0 auto 30px; background: white; padding: 20px; border-radius: 6px; box-shadow: 0 0 10px #ccc; }
  label { display: block; margin: 10px 0 5px; }
  input[type=text], input[type=number], select { width: 100%; padding: 8px; box-sizing: border-box; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
  th { background-color: #4CAF50; color: white; }
  #orcamento-final, #recibo-final { max-width: 700px; margin: 20px auto; background: white; padding: 20px; border-radius: 6px; box-shadow: 0 0 10px #ccc; display: none; }
  button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 4px; margin-top: 15px; }
  button:disabled { background-color: #888; cursor: not-allowed; }
  .assinaturas { display: flex; justify-content: space-between; margin-top: 50px; }
  .assinatura-box {
    border-top: 1px solid #000;
    width: 40%;
    text-align: center;
    padding-top: 5px;
    font-weight: bold;
  }
  input.valor-unitario {
    width: 80px;
    text-align: right;
  }
  .btn-group {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    justify-content: center;
  }
  /* Para esconder os botões ao capturar a imagem */
  .no-print {
    display: block;
  }
  .hide-buttons {
    display: none !important;
  }
  /* Estilo dos campos extras no recibo */
  #recibo-final label {
    font-weight: bold;
    margin-top: 10px;
    display: block;
  }
  #recibo-final input {
    width: 100%;
    margin-bottom: 10px;
    padding: 6px;
    box-sizing: border-box;
  }
</style>
</head>
<body>

<h1>Elite Car - Orçamento e Recibo</h1>

<form id="form-orcamento">
  <h2>Orçamento</h2>
  <label for="cliente">Nome do Cliente:</label>
  <input type="text" id="cliente" required />

  <label for="veiculo">Veículo:</label>
  <input type="text" id="veiculo" required />

  <table id="tabela-itens">
    <thead>
      <tr>
        <th>Selecionar</th>
        <th>Peça</th>
        <th>Unidade</th>
        <th>Valor Unitário (R$)</th>
        <th>Total (R$)</th>
      </tr>
    </thead>
    <tbody>
      <!-- Linhas criadas via JS -->
    </tbody>
  </table>

  <label><input type="checkbox" id="pintura-fora" /> Pintura Fora</label>
  <input type="number" id="valor-pintura-fora" disabled placeholder="Valor Pintura Fora (R$)" min="0" step="0.01" />

  <label><input type="checkbox" id="pintura-fora-e-dentro" /> Pintura Fora e Dentro</label>
  <input type="number" id="valor-pintura-fora-e-dentro" disabled placeholder="Valor Pintura Fora e Dentro (R$)" min="0" step="0.01" />

  <p><strong>Valor Total: R$ <span id="valor-total">0.00</span></strong></p>

  <button type="submit">Gerar Orçamento</button>
</form>

<section id="orcamento-final">
  <h2>Resumo do Orçamento</h2>

  <!-- Dados fixos da empresa -->
  <p><strong>Elite Car Serviços Automotivos</strong></p>
  <p>Endereço: Rua Exemplo, 123 - Cidade, Estado</p>
  <p>Telefone: (00) 0000-0000 | Email: contato@elitecar.com.br</p>
  <hr />

  <p><strong>Data:</strong> <span id="out-data"></span> <strong>Hora:</strong> <span id="out-hora"></span></p>
  <p><strong>Cliente:</strong> <span id="out-cliente"></span></p>
  <p><strong>Veículo:</strong> <span id="out-veiculo"></span></p>

  <table id="tabela-resumo">
    <thead>
      <tr>
        <th>Peça</th>
        <th>Unidade</th>
        <th>Valor Unitário (R$)</th>
        <th>Total (R$)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p><strong>Valor Total: R$ <span id="out-valor-total"></span></strong></p>

  <div class="assinaturas">
    <div class="assinatura-box">Assinatura do Cliente</div>
    <div class="assinatura-box">Assinatura do Prestador</div>
  </div>

  <div class="btn-group no-print">
    <button id="btn-baixar-orcamento" disabled>Baixar Orçamento</button>
    <button id="btn-compartilhar-orcamento" disabled>Compartilhar Orçamento</button>
  </div>
</section>

<form id="form-recibo" style="max-width:700px; margin: 40px auto 0; background:#fff; padding:20px; border-radius:6px; box-shadow: 0 0 10px #ccc;">
  <h2>Recibo</h2>

  <!-- Dados fixos da empresa -->
  <p><strong>Elite Car Serviços Automotivos</strong></p>
  <p>Endereço: Rua Exemplo, 123 - Cidade, Estado</p>
  <p>Telefone: (00) 0000-0000 | Email: contato@elitecar.com.br</p>
  <hr />

  <label for="recibo-cliente">Nome do Cliente:</label>
  <input type="text" id="recibo-cliente" required />

  <label for="recibo-valor-total">Valor Total do Orçamento (R$):</label>
  <input type="number" id="recibo-valor-total" min="0" step="0.01" required />

  <label for="recibo-valor-pago">Valor Pago pelo Cliente (R$):</label>
  <input type="number" id="recibo-valor-pago" min="0" step="0.01" required />

  <label for="recibo-valor-falta">Valor que Falta Pagar (R$):</label>
  <input type="number" id="recibo-valor-falta" readonly style="background:#eee;" />

  <label for="recibo-pagamento">Forma de Pagamento:</label>
  <select id="recibo-pagamento" required>
    <option value="">Selecione</option>
    <option value="Dinheiro">Dinheiro</option>
    <option value="Pix">Pix</option>
    <option value="Cartão">Cartão</option>
    <option value="Outro">Outro</option>
  </select>

  <button type="submit">Gerar Recibo</button>
</form>

<section id="recibo-final" style="max-width:700px; margin: 20px auto; background:#fff; padding:20px; border-radius:6px; box-shadow: 0 0 10px #ccc; display:none;">
  <h2>Recibo de Pagamento - Elite Car</h2>

  <!-- Dados fixos da empresa -->
  <p><strong>Elite Car Serviços Automotivos</strong></p>
  <p>Endereço: Rua Exemplo, 123 - Cidade, Estado</p>
  <p>Telefone: (00) 0000-0000 | Email: contato@elitecar.com.br</p>
  <hr />

  <p>Recebemos de: <span id="out-recibo-cliente"></span></p>
  <p>Valor Total do Orçamento: R$ <span id="out-recibo-valor-total"></span></p>
  <p>Valor Pago: R$ <span id="out-recibo-valor-pago"></span></p>
  <p>Valor que Falta: R$ <span id="out-recibo-valor-falta"></span></p>
  <p>Forma de pagamento: <span id="out-recibo-pagamento"></span></p>
  <p>Data: <span id="out-recibo-data"></span></p>

  <div class="assinaturas">
    <div class="assinatura-box">Assinatura do Cliente</div>
    <div class="assinatura-box">Assinatura do Prestador</div>
  </div>

  <div class="btn-group no-print">
    <button id="btn-baixar-recibo" disabled>Baixar Recibo</button>
    <button id="btn-compartilhar-recibo" disabled>Compartilhar Recibo</button>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  // Dados das peças para popular tabela
  const pecas = [
    { nome: "Motor", unidade: "unidade", valor: 1500.00 },
    { nome: "Filtro de Ar", unidade: "unidade", valor: 100.00 },
    { nome: "Óleo", unidade: "litro", valor: 30.00 },
    { nome: "Pneu", unidade: "unidade", valor: 400.00 },
    { nome: "Pastilha de Freio", unidade: "par", valor: 120.00 },
  ];

  const tabelaBody = document.querySelector("#tabela-itens tbody");

  // Preencher tabela orçamento
  pecas.forEach((peca, i) => {
    const tr = document.createElement("tr");

    const tdSelecionar = document.createElement("td");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.className = "item-checkbox";
    checkbox.dataset.index = i;
    tdSelecionar.appendChild(checkbox);

    const tdNome = document.createElement("td");
    tdNome.textContent = peca.nome;

    const tdUnidade = document.createElement("td");
    tdUnidade.textContent = peca.unidade;

    const tdValorUnitario = document.createElement("td");
    const inputValor = document.createElement("input");
    inputValor.type = "number";
    inputValor.min = "0";
    inputValor.step = "0.01";
    inputValor.className = "valor-unitario";
    inputValor.value = peca.valor.toFixed(2);
    inputValor.dataset.index = i;
    inputValor.disabled = true; // só habilita se selecionado
    tdValorUnitario.appendChild(inputValor);

    const tdTotal = document.createElement("td");
    tdTotal.textContent = "0.00";

    tr.appendChild(tdSelecionar);
    tr.appendChild(tdNome);
    tr.appendChild(tdUnidade);
    tr.appendChild(tdValorUnitario);
    tr.appendChild(tdTotal);

    tabelaBody.appendChild(tr);
  });

  // Controlar habilitação dos inputs de valor unitário ao selecionar peça
  tabelaBody.addEventListener("change", (e) => {
    if(e.target.classList.contains("item-checkbox")) {
      const idx = e.target.dataset.index;
      const inputValor = document.querySelector(`input.valor-unitario[data-index="${idx}"]`);
      inputValor.disabled = !e.target.checked;
      if(!e.target.checked) {
        // Reset total e valor unitário para padrão
        inputValor.value = pecas[idx].valor.toFixed(2);
        e.target.closest("tr").querySelector("td:last-child").textContent = "0.00";
      }
      atualizarValorTotal();
    }
  });

  // Atualizar total da linha ao mudar valor unitário
  tabelaBody.addEventListener("input", (e) => {
    if(e.target.classList.contains("valor-unitario")) {
      const valor = parseFloat(e.target.value) || 0;
      const linha = e.target.closest("tr");
      const checkbox = linha.querySelector(".item-checkbox");
      if(checkbox.checked) {
        linha.querySelector("td:last-child").textContent = valor.toFixed(2);
      } else {
        linha.querySelector("td:last-child").textContent = "0.00";
      }
      atualizarValorTotal();
    }
  });

  // Pintura fora e pintura fora e dentro
  const pinturaFora = document.getElementById("pintura-fora");
  const valorPinturaFora = document.getElementById("valor-pintura-fora");
  const pinturaForaEDentro = document.getElementById("pintura-fora-e-dentro");
  const valorPinturaForaEDentro = document.getElementById("valor-pintura-fora-e-dentro");

  pinturaFora.addEventListener("change", () => {
    valorPinturaFora.disabled = !pinturaFora.checked;
    if(!pinturaFora.checked) {
      valorPinturaFora.value = "";
    }
    atualizarValorTotal();
  });
  valorPinturaFora.addEventListener("input", atualizarValorTotal);

  pinturaForaEDentro.addEventListener("change", () => {
    valorPinturaForaEDentro.disabled = !pinturaForaEDentro.checked;
    if(!pinturaForaEDentro.checked) {
      valorPinturaForaEDentro.value = "";
    }
    atualizarValorTotal();
  });
  valorPinturaForaEDentro.addEventListener("input", atualizarValorTotal);

  function atualizarValorTotal() {
    let total = 0;
    tabelaBody.querySelectorAll("tr").forEach(tr => {
      const checkbox = tr.querySelector(".item-checkbox");
      const valorUnitario = parseFloat(tr.querySelector("input.valor-unitario").value) || 0;
      if(checkbox.checked) {
        total += valorUnitario;
      }
    });
    if(pinturaFora.checked) {
      total += parseFloat(valorPinturaFora.value) || 0;
    }
    if(pinturaForaEDentro.checked) {
      total += parseFloat(valorPinturaForaEDentro.value) || 0;
    }
    document.getElementById("valor-total").textContent = total.toFixed(2);
  }

  // Gerar orçamento
  document.getElementById("form-orcamento").addEventListener("submit", e => {
    e.preventDefault();
    const cliente = document.getElementById("cliente").value;
    const veiculo = document.getElementById("veiculo").value;
    const data = new Date();
    document.getElementById("out-data").textContent = data.toLocaleDateString();
    document.getElementById("out-hora").textContent = data.toLocaleTimeString();
    document.getElementById("out-cliente").textContent = cliente;
    document.getElementById("out-veiculo").textContent = veiculo;

    const tbodyResumo = document.querySelector("#tabela-resumo tbody");
    tbodyResumo.innerHTML = "";

    // Peças selecionadas
    tabelaBody.querySelectorAll("tr").forEach(tr => {
      const checkbox = tr.querySelector(".item-checkbox");
      if(checkbox.checked) {
        const nome = tr.cells[1].textContent;
        const unidade = tr.cells[2].textContent;
        const valorUnit = parseFloat(tr.querySelector("input.valor-unitario").value) || 0;
        const totalPeca = valorUnit;
        const trResumo = document.createElement("tr");
        trResumo.innerHTML = `<td>${nome}</td><td>${unidade}</td><td>${valorUnit.toFixed(2)}</td><td>${totalPeca.toFixed(2)}</td>`;
        tbodyResumo.appendChild(trResumo);
      }
    });

    // Itens de pintura
    if(pinturaFora.checked) {
      const val = parseFloat(valorPinturaFora.value) || 0;
      const trResumo = document.createElement("tr");
      trResumo.innerHTML = `<td>Pintura Fora</td><td>serviço</td><td>${val.toFixed(2)}</td><td>${val.toFixed(2)}</td>`;
      tbodyResumo.appendChild(trResumo);
    }
    if(pinturaForaEDentro.checked) {
      const val = parseFloat(valorPinturaForaEDentro.value) || 0;
      const trResumo = document.createElement("tr");
      trResumo.innerHTML = `<td>Pintura Fora e Dentro</td><td>serviço</td><td>${val.toFixed(2)}</td><td>${val.toFixed(2)}</td>`;
      tbodyResumo.appendChild(trResumo);
    }

    const valorTotal = parseFloat(document.getElementById("valor-total").textContent);
    document.getElementById("out-valor-total").textContent = valorTotal.toFixed(2);

    document.getElementById("orcamento-final").style.display = "block";

    // Ativar botões de baixar e compartilhar
    btnBaixarOrcamento.disabled = false;
    btnCompartilharOrcamento.disabled = false;
  });

  // Cálculo valor que falta no recibo
  const inputValorTotalRecibo = document.getElementById("recibo-valor-total");
  const inputValorPagoRecibo = document.getElementById("recibo-valor-pago");
  const inputValorFaltaRecibo = document.getElementById("recibo-valor-falta");

  function atualizarValorFalta() {
    const total = parseFloat(inputValorTotalRecibo.value) || 0;
    const pago = parseFloat(inputValorPagoRecibo.value) || 0;
    let falta = total - pago;
    if(falta < 0) falta = 0;
    inputValorFaltaRecibo.value = falta.toFixed(2);
  }

  inputValorTotalRecibo.addEventListener("input", atualizarValorFalta);
  inputValorPagoRecibo.addEventListener("input", atualizarValorFalta);

  // Gerar recibo
  document.getElementById("form-recibo").addEventListener("submit", e => {
    e.preventDefault();

    const cliente = document.getElementById("recibo-cliente").value;
    const valorTotal = parseFloat(document.getElementById("recibo-valor-total").value) || 0;
    const valorPago = parseFloat(document.getElementById("recibo-valor-pago").value) || 0;
    const valorFalta = parseFloat(document.getElementById("recibo-valor-falta").value) || 0;
    const pagamento = document.getElementById("recibo-pagamento").value;
    const data = new Date();

    if(!cliente || !pagamento) {
      alert("Preencha todos os campos corretamente.");
      return;
    }

    document.getElementById("out-recibo-cliente").textContent = cliente;
    document.getElementById("out-recibo-valor-total").textContent = valorTotal.toFixed(2);
    document.getElementById("out-recibo-valor-pago").textContent = valorPago.toFixed(2);
    document.getElementById("out-recibo-valor-falta").textContent = valorFalta.toFixed(2);
    document.getElementById("out-recibo-pagamento").textContent = pagamento;
    document.getElementById("out-recibo-data").textContent = data.toLocaleDateString();

    document.getElementById("recibo-final").style.display = "block";

    // Ativar botões de baixar e compartilhar
    btnBaixarRecibo.disabled = false;
    btnCompartilharRecibo.disabled = false;
  });

  // Botões de baixar e compartilhar
  const btnBaixarOrcamento = document.getElementById("btn-baixar-orcamento");
  const btnCompartilharOrcamento = document.getElementById("btn-compartilhar-orcamento");
  const btnBaixarRecibo = document.getElementById("btn-baixar-recibo");
  const btnCompartilharRecibo = document.getElementById("btn-compartilhar-recibo");

  async function capturarEbaixar(element) {
    // Esconde botões antes de capturar
    document.querySelectorAll(".no-print").forEach(el => el.classList.add("hide-buttons"));

    // Captura imagem
    const canvas = await html2canvas(element, { scale: 2 });

    // Reexibe botões
    document.querySelectorAll(".no-print").forEach(el => el.classList.remove("hide-buttons"));

    // Salvar imagem
    const link = document.createElement("a");
    link.download = "imagem.png";
    link.href = canvas.toDataURL();
    link.click();
  }

  btnBaixarOrcamento.addEventListener("click", () => {
    const orcamento = document.getElementById("orcamento-final");
    capturarEbaixar(orcamento);
  });

  btnBaixarRecibo.addEventListener("click", () => {
    const recibo = document.getElementById("recibo-final");
    capturarEbaixar(recibo);
  });

  // Compartilhar com API Web Share (se disponível)
  async function capturarEcompartilhar(element, nomeArquivo) {
    if(!navigator.canShare || !navigator.canShare()) {
      alert("Compartilhamento não suportado neste navegador.");
      return;
    }

    // Esconde botões
    document.querySelectorAll(".no-print").forEach(el => el.classList.add("hide-buttons"));

    const canvas = await html2canvas(element, { scale: 2 });
    const blob = await new Promise(resolve => canvas.toBlob(resolve));

    document.querySelectorAll(".no-print").forEach(el => el.classList.remove("hide-buttons"));

    const file = new File([blob], nomeArquivo, { type: "image/png" });

    try {
      await navigator.share({
        files: [file],
        title: nomeArquivo,
        text: `Arquivo ${nomeArquivo}`
      });
    } catch (err) {
      console.error("Erro ao compartilhar:", err);
    }
  }

  btnCompartilharOrcamento.addEventListener("click", () => {
    const orcamento = document.getElementById("orcamento-final");
    capturarEcompartilhar(orcamento, "orcamento-elitecar.png");
  });

  btnCompartilharRecibo.addEventListener("click", () => {
    const recibo = document.getElementById("recibo-final");
    capturarEcompartilhar(recibo, "recibo-elitecar.png");
  });
</script>
</body>
</html>
