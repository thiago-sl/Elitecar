<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orçamento e Recibo Elite Car</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    background: #f9f9f9; 
    margin: 0; 
    padding: 20px; 
    display: flex; 
    flex-direction: column; 
    align-items: center;
  }
  h1, h2 { 
    text-align: center; 
  }
  form {
    width: 100%;
    max-width: 700px; 
    margin-bottom: 30px; 
    background: white; 
    padding: 20px; 
    border-radius: 6px; 
    box-shadow: 0 0 10px #ccc; 
    box-sizing: border-box;
  }
  label {
    display: block; 
    margin: 10px 0 5px;
  }
  input[type=text], input[type=number], select {
    width: 100%; 
    padding: 8px; 
    box-sizing: border-box;
  }
  table {
    width:100%; 
    border-collapse: collapse; 
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ddd; 
    padding: 8px; 
    text-align: center;
  }
  th {
    background-color: #4CAF50; 
    color: white;
  }
  #orcamento-final, #recibo-final {
    width: 100%;
    max-width: 700px; 
    margin: 20px auto; 
    background: white; 
    padding: 20px; 
    border-radius: 6px; 
    box-shadow: 0 0 10px #ccc; 
    display: none;
    box-sizing: border-box;
  }
  button {
    padding: 10px 20px; 
    background-color: #4CAF50; 
    color: white; 
    border: none; 
    cursor: pointer; 
    border-radius: 4px; 
    margin-top: 15px;
  }
  button:disabled {
    background-color: #888; 
    cursor: not-allowed;
  }
  .assinaturas {
    display: flex; 
    justify-content: space-between; 
    margin-top: 50px;
  }
  .assinatura-box {
    border-top: 1px solid #000;
    width: 40%;
    text-align: center;
    padding-top: 5px;
    font-weight: bold;
  }
  input.valor-unitario, input.quantidade {
    width: 80px;
    text-align: right;
  }
  .btn-group {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    justify-content: center;
  }
  /* Para esconder os botões ao capturar a imagem */
  .no-print {
    display: block;
  }
  .hide-buttons {
    display: none !important;
  }
  /* Estilo dos campos extras no recibo */
  #recibo-final label {
    font-weight: bold;
    margin-top: 10px;
    display: block;
  }
  #recibo-final input {
    width: 100%;
    margin-bottom: 10px;
    padding: 6px;
    box-sizing: border-box;
  }

  /* Responsividade */
  @media (max-width: 768px) {
    .assinaturas {
      flex-direction: column;
      gap: 20px;
      margin-top: 30px;
    }
    .assinatura-box {
      width: 100%;
    }
   
    input.valor-unitario, input.quantidade {
      width: 100%;
      box-sizing: border-box;
      text-align: left;
    }
  }
  
 #tabela-resumo-wrapper {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* rolagem suave no iOS */
    border: 1px solid #ccc;
    margin-bottom: 1rem;
  }

  table
   {
    width:100%;
    border-collapse: collapse;
    min-width: 600px; /* largura mínima para evitar quebra da tabela */
  }

  table th,
  #tabela-resumo td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: left;
    white-space: nowrap; /* evita quebra nas células */
    font-size: 14px;
  }

  /* Ajustes para telas pequenas (mobile) */
     @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }

      thead tr {
        display: none;
      }

      tbody tr {
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 6px;
        padding: 10px;
        background-color: #fff;
      }

      tbody td {
        text-align: right;
        padding-left: 50%;
        position: relative;
      }

      tbody td::before {
        content: attr(data-label);
        position: absolute;
        left: 10px;
        width: 45%;
        padding-left: 10px;
        font-weight: bold;
        text-align: left;
      }
    }

  
  
</style>
</head>
<body>

<h1>Elite Car - Orçamento e Recibo</h1>

<form id="form-orcamento">
  <h2>Orçamento</h2>
  <label for="cliente">Nome do Cliente:</label>
  <input type="text" id="cliente" required />

  <label for="veiculo">Veículo:</label>
  <input type="text" id="veiculo" required />

  <table id="tabela-itens">
    <thead>
      <tr>
        <th>Selecionar</th>
        <th>Peça</th>
        <th>Unidade</th>
        <th>Quantidade</th>
        <th>Valor Unitário (R$)</th>
        <th>Total (R$)</th>
      </tr>
    </thead>
    <tbody>
      <!-- Linhas criadas via JS -->
    </tbody>
  </table>

  <label><input type="checkbox" id="pintura-fora" /> Pintura Fora</label>
  <input type="number" id="valor-pintura-fora" disabled placeholder="Valor Pintura Fora (R$)" min="0" step="0.01" />

  <label><input type="checkbox" id="pintura-fora-e-dentro" /> Pintura Fora e Dentro</label>
  <input type="number" id="valor-pintura-fora-e-dentro" disabled placeholder="Valor Pintura Fora e Dentro (R$)" min="0" step="0.01" />

  <p><strong>Valor Total: R$ <span id="valor-total">0.00</span></strong></p>

  <button type="submit">Gerar Orçamento</button>
</form>

<section id="orcamento-final">
  <h2>Resumo do Orçamento</h2>

  <p><strong>Elite Car Serviços Automotivos</strong></p>
  <p>Endereço: Rua Exemplo, 123 - Cidade, Estado</p>
  <p>Telefone: (00) 0000-0000 | Email: contato@elitecar.com.br</p>
  <hr />

  <p><strong>Data:</strong> <span id="out-data"></span> <strong>Hora:</strong> <span id="out-hora"></span></p>
  <p><strong>Cliente:</strong> <span id="out-cliente"></span></p>
  <p><strong>Veículo:</strong> <span id="out-veiculo"></span></p>

  <table id="tabela-resumo">
    <thead>
      <tr>
        <th>Peça</th>
        <th>Unidade</th>
        <th>Quantidade</th>
        <th>Valor Unitário (R$)</th>
        <th>Total (R$)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p><strong>Valor Total: R$ <span id="out-valor-total"></span></strong></p>

  <div class="assinaturas">
    <div class="assinatura-box">Assinatura do Cliente</div>
    <div class="assinatura-box">Assinatura do Prestador</div>
  </div>

  <div class="btn-group no-print">
    <button id="btn-baixar-orcamento" disabled>Baixar Orçamento</button>
    <button id="btn-compartilhar-orcamento" disabled>Compartilhar Orçamento</button>
  </div>
</section>

<form id="form-recibo" style="margin-top: 40px;">
  <h2>Recibo</h2>

  <p><strong>Elite Car Serviços Automotivos</strong></p>
  <p>Endereço: Rua Exemplo, 123 - Cidade, Estado</p>
  <p>Telefone: (00) 0000-0000 | Email: contato@elitecar.com.br</p>
  <hr />

  <label for="recibo-cliente">Nome do Cliente:</label>
  <input type="text" id="recibo-cliente" required />

  <label for="recibo-valor-total">Valor Total do Orçamento (R$):</label>
  <input type="number" id="recibo-valor-total" min="0" step="0.01" required />

  <label for="recibo-valor-pago">Valor Pago pelo Cliente (R$):</label>
  <input type="number" id="recibo-valor-pago" min="0" step="0.01" required />

  <label for="recibo-valor-falta">Valor que Falta Pagar (R$):</label>
  <input type="number" id="recibo-valor-falta" readonly style="background:#eee;" />

  <label for="recibo-pagamento">Forma de Pagamento:</label>
  <select id="recibo-pagamento" required>
    <option value="">Selecione</option>
    <option value="Dinheiro">Dinheiro</option>
    <option value="Pix">Pix</option>
    <option value="Cartão">Cartão</option>
    <option value="Outro">Outro</option>
  </select>

  <button type="submit">Gerar Recibo</button>
</form>

<section id="recibo-final" style="margin-bottom: 60px;">
  <h2>Recibo</h2>

  <p><strong>Elite Car Serviços Automotivos</strong></p>
  <p>Endereço: Rua Exemplo, 123 - Cidade, Estado</p>
  <p>Telefone: (00) 0000-0000 | Email: contato@elitecar.com.br</p>
  <hr />

  <p><strong>Data:</strong> <span id="recibo-data"></span></p>
  <p><strong>Cliente:</strong> <span id="recibo-nome-cliente"></span></p>
  <p><strong>Valor Total do Orçamento:</strong> R$ <span id="recibo-valor-total-texto"></span></p>
  <p><strong>Valor Pago:</strong> R$ <span id="recibo-valor-pago-texto"></span></p>
  <p><strong>Valor que Falta Pagar:</strong> R$ <span id="recibo-valor-falta-texto"></span></p>
  <p><strong>Forma de Pagamento:</strong> <span id="recibo-forma-pagamento"></span></p>

  <div class="assinaturas">
    <div class="assinatura-box">Assinatura do Cliente</div>
    <div class="assinatura-box">Assinatura do Prestador</div>
  </div>

  <div class="btn-group no-print">
    <button id="btn-baixar-recibo" disabled>Baixar Recibo</button>
    <button id="btn-compartilhar-recibo" disabled>Compartilhar Recibo</button>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  // Dados iniciais para as peças
  const pecas = [
    { nome: "Pneu", unidade: "un", preco: 0.00 },
    { nome: "Parafuso", unidade: "cx", preco: 0.00 },
    { nome: "Filtro", unidade: "un", preco: 0.00 },
    { nome: "Óleo", unidade: "lt", preco:0.00 }
  ];

  const tbodyTabela = document.querySelector('#tabela-itens tbody');
  const valorTotalEl = document.getElementById('valor-total');

  // Função para criar as linhas da tabela de orçamento
  function criarLinhasTabela() {
    pecas.forEach((peca, idx) => {
      const tr = document.createElement('tr');

      // Checkbox para selecionar
      const tdSelecionar = document.createElement('td');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.classList.add('checkbox-peca');
      checkbox.dataset.index = idx;
      tdSelecionar.appendChild(checkbox);
      tr.appendChild(tdSelecionar);

      // Nome da peça
      const tdNome = document.createElement('td');
      tdNome.textContent = peca.nome;
      tr.appendChild(tdNome);

      // Unidade
      const tdUnidade = document.createElement('td');
      tdUnidade.textContent = peca.unidade;
      tr.appendChild(tdUnidade);

      // Quantidade (input, só habilitado se checkbox marcado)
      const tdQtd = document.createElement('td');
      const inputQtd = document.createElement('input');
      inputQtd.type = 'number';
      inputQtd.min = '1';
      inputQtd.value = 1;
      inputQtd.classList.add('quantidade');
      inputQtd.disabled = true;
      tdQtd.appendChild(inputQtd);
      tr.appendChild(tdQtd);

      // Valor Unitário (input, só habilitado se checkbox marcado)
      const tdValorUnit = document.createElement('td');
      const inputValorUnit = document.createElement('input');
      inputValorUnit.type = 'number';
      inputValorUnit.min = '0';
      inputValorUnit.step = '0.01';
      inputValorUnit.value = peca.preco.toFixed(2);
      inputValorUnit.classList.add('valor-unitario');
      inputValorUnit.disabled = true;
      tdValorUnit.appendChild(inputValorUnit);
      tr.appendChild(tdValorUnit);

      // Total (calculado)
      const tdTotal = document.createElement('td');
      tdTotal.textContent = '0.00';
      tr.appendChild(tdTotal);

      tbodyTabela.appendChild(tr);

      // Eventos
      checkbox.addEventListener('change', () => {
        inputQtd.disabled = !checkbox.checked;
        inputValorUnit.disabled = !checkbox.checked;
        if (!checkbox.checked) {
          tdTotal.textContent = '0.00';
        } else {
          atualizarTotalLinha(inputQtd, inputValorUnit, tdTotal);
        }
        atualizarValorTotal();
      });

      inputQtd.addEventListener('input', () => {
        atualizarTotalLinha(inputQtd, inputValorUnit, tdTotal);
        atualizarValorTotal();
      });

      inputValorUnit.addEventListener('input', () => {
        atualizarTotalLinha(inputQtd, inputValorUnit, tdTotal);
        atualizarValorTotal();
      });
    });
  }

  function atualizarTotalLinha(qtdInput, valorUnitInput, tdTotal) {
    let qtd = parseFloat(qtdInput.value);
    let valorUnit = parseFloat(valorUnitInput.value);
    if (isNaN(qtd) || qtd < 0) qtd = 0;
    if (isNaN(valorUnit) || valorUnit < 0) valorUnit = 0;
    const total = qtd * valorUnit;
    tdTotal.textContent = total.toFixed(2);
  }

  function atualizarValorTotal() {
    let soma = 0;
    const linhas = tbodyTabela.querySelectorAll('tr');
    linhas.forEach(tr => {
      const checkbox = tr.querySelector('input[type=checkbox]');
      if (checkbox.checked) {
        const totalTd = tr.cells[5];
        const total = parseFloat(totalTd.textContent);
        if (!isNaN(total)) soma += total;
      }
    });

    // Adiciona valor pintura
    const pinturaForaCheck = document.getElementById('pintura-fora');
    const pinturaForaValor = parseFloat(document.getElementById('valor-pintura-fora').value) || 0;

    const pinturaForaEDentroCheck = document.getElementById('pintura-fora-e-dentro');
    const pinturaForaEDentroValor = parseFloat(document.getElementById('valor-pintura-fora-e-dentro').value) || 0;

    if (pinturaForaCheck.checked) soma += pinturaForaValor;
    if (pinturaForaEDentroCheck.checked) soma += pinturaForaEDentroValor;

    valorTotalEl.textContent = soma.toFixed(2);
  }

  // Habilitar/desabilitar inputs de pintura conforme checkbox
  document.getElementById('pintura-fora').addEventListener('change', (e) => {
    document.getElementById('valor-pintura-fora').disabled = !e.target.checked;
    if (!e.target.checked) {
      document.getElementById('valor-pintura-fora').value = '';
    }
    atualizarValorTotal();
  });
  document.getElementById('valor-pintura-fora').addEventListener('input', atualizarValorTotal);

  document.getElementById('pintura-fora-e-dentro').addEventListener('change', (e) => {
    document.getElementById('valor-pintura-fora-e-dentro').disabled = !e.target.checked;
    if (!e.target.checked) {
      document.getElementById('valor-pintura-fora-e-dentro').value = '';
    }
    atualizarValorTotal();
  });
  document.getElementById('valor-pintura-fora-e-dentro').addEventListener('input', atualizarValorTotal);

  // Inicializa linhas da tabela
  criarLinhasTabela();

  // Form Orçamento submit
  document.getElementById('form-orcamento').addEventListener('submit', (e) => {
    e.preventDefault();

    // Validação simples: pelo menos 1 peça selecionada
    const algumSelecionado = Array.from(document.querySelectorAll('.checkbox-peca')).some(cb => cb.checked);
    if (!algumSelecionado) {
      alert('Selecione ao menos uma peça para gerar o orçamento.');
      return;
    }

    // Pega dados do cliente e veículo
    const cliente = document.getElementById('cliente').value.trim();
    const veiculo = document.getElementById('veiculo').value.trim();

    if (!cliente || !veiculo) {
      alert('Preencha nome do cliente e veículo.');
      return;
    }

    // Pega data e hora atual
    const agora = new Date();
    const dataStr = agora.toLocaleDateString('pt-BR');
    const horaStr = agora.toLocaleTimeString('pt-BR');

    // Atualiza elementos do resumo
    document.getElementById('out-data').textContent = dataStr;
    document.getElementById('out-hora').textContent = horaStr;
    document.getElementById('out-cliente').textContent = cliente;
    document.getElementById('out-veiculo').textContent = veiculo;

    // Limpa tabela resumo
    const tbodyResumo = document.querySelector('#tabela-resumo tbody');
    tbodyResumo.innerHTML = '';

    // Monta lista peças selecionadas com dados atualizados
    const linhas = tbodyTabela.querySelectorAll('tr');
    linhas.forEach(tr => {
      const checkbox = tr.querySelector('input[type=checkbox]');
      if (checkbox.checked) {
        const peca = tr.cells[1].textContent;
        const unidade = tr.cells[2].textContent;
        const qtd = tr.querySelector('input.quantidade').value;
        const valorUnit = parseFloat(tr.querySelector('input.valor-unitario').value).toFixed(2);
        const total = parseFloat(tr.cells[5].textContent).toFixed(2);

        const trResumo = document.createElement('tr');
        trResumo.innerHTML = `<td>${peca}</td><td>${unidade}</td><td>${qtd}</td><td>${valorUnit}</td><td>${total}</td>`;
        tbodyResumo.appendChild(trResumo);
      }
    });

    // Adiciona linhas extras para pintura, se marcado
    const pinturaForaCheck = document.getElementById('pintura-fora');
    const pinturaForaValor = parseFloat(document.getElementById('valor-pintura-fora').value) || 0;

    if (pinturaForaCheck.checked && pinturaForaValor > 0) {
      const trPintura = document.createElement('tr');
      trPintura.innerHTML = `<td>Pintura Fora</td><td>serv</td><td>1</td><td>${pinturaForaValor.toFixed(2)}</td><td>${pinturaForaValor.toFixed(2)}</td>`;
      tbodyResumo.appendChild(trPintura);
    }

    const pinturaForaEDentroCheck = document.getElementById('pintura-fora-e-dentro');
    const pinturaForaEDentroValor = parseFloat(document.getElementById('valor-pintura-fora-e-dentro').value) || 0;

    if (pinturaForaEDentroCheck.checked && pinturaForaEDentroValor > 0) {
      const trPintura2 = document.createElement('tr');
      trPintura2.innerHTML = `<td>Pintura Fora e Dentro</td><td>serv</td><td>1</td><td>${pinturaForaEDentroValor.toFixed(2)}</td><td>${pinturaForaEDentroValor.toFixed(2)}</td>`;
      tbodyResumo.appendChild(trPintura2);
    }

    // Atualiza valor total do resumo
    document.getElementById('out-valor-total').textContent = valorTotalEl.textContent;

    // Exibe o resumo
    document.getElementById('orcamento-final').style.display = 'block';

    // Habilita botões de baixar e compartilhar orçamento
    document.getElementById('btn-baixar-orcamento').disabled = false;
    document.getElementById('btn-compartilhar-orcamento').disabled = false;
  });

  // Botões baixar e compartilhar orçamento
  const btnBaixarOrc = document.getElementById('btn-baixar-orcamento');
  const btnCompartilharOrc = document.getElementById('btn-compartilhar-orcamento');

  btnBaixarOrc.addEventListener('click', () => {
    gerarImagemEDownload('orcamento-final', 'Orcamento-EliteCar.png');
  });

  btnCompartilharOrc.addEventListener('click', async () => {
    try {
      const blob = await gerarImagem('orcamento-final');
      const file = new File([blob], 'Orcamento-EliteCar.png', { type: 'image/png' });
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({
          files: [file],
          title: 'Orçamento Elite Car',
          text: 'Segue o orçamento gerado no site Elite Car.',
        });
      } else {
        alert('Seu dispositivo não suporta o compartilhamento direto de arquivos.');
      }
    } catch (err) {
      alert('Erro ao tentar compartilhar: ' + err);
    }
  });

  // Form Recibo

  // Atualiza valor que falta pagar automaticamente
  const valorTotalInput = document.getElementById('recibo-valor-total');
  const valorPagoInput = document.getElementById('recibo-valor-pago');
  const valorFaltaInput = document.getElementById('recibo-valor-falta');

  function atualizarValorFalta() {
    const total = parseFloat(valorTotalInput.value) || 0;
    const pago = parseFloat(valorPagoInput.value) || 0;
    let falta = total - pago;
    if (falta < 0) falta = 0;
    valorFaltaInput.value = falta.toFixed(2);
  }

  valorTotalInput.addEventListener('input', atualizarValorFalta);
  valorPagoInput.addEventListener('input', atualizarValorFalta);

  // Submissão do recibo
  document.getElementById('form-recibo').addEventListener('submit', (e) => {
    e.preventDefault();

    const cliente = document.getElementById('recibo-cliente').value.trim();
    const valorTotal = parseFloat(document.getElementById('recibo-valor-total').value);
    const valorPago = parseFloat(document.getElementById('recibo-valor-pago').value);
    const valorFalta = parseFloat(document.getElementById('recibo-valor-falta').value);
    const formaPagamento = document.getElementById('recibo-pagamento').value;

    if (!cliente || isNaN(valorTotal) || isNaN(valorPago) || !formaPagamento) {
      alert('Preencha todos os campos corretamente.');
      return;
    }

    // Atualiza data e conteúdo do recibo
    const hoje = new Date();
    document.getElementById('recibo-data').textContent = hoje.toLocaleDateString('pt-BR');
    document.getElementById('recibo-nome-cliente').textContent = cliente;
    document.getElementById('recibo-valor-total-texto').textContent = valorTotal.toFixed(2);
    document.getElementById('recibo-valor-pago-texto').textContent = valorPago.toFixed(2);
    document.getElementById('recibo-valor-falta-texto').textContent = valorFalta.toFixed(2);
    document.getElementById('recibo-forma-pagamento').textContent = formaPagamento;

    document.getElementById('recibo-final').style.display = 'block';

    // Habilita botões do recibo
    document.getElementById('btn-baixar-recibo').disabled = false;
    document.getElementById('btn-compartilhar-recibo').disabled = false;
  });

  // Botões do recibo
  const btnBaixarRecibo = document.getElementById('btn-baixar-recibo');
  const btnCompartilharRecibo = document.getElementById('btn-compartilhar-recibo');

  btnBaixarRecibo.addEventListener('click', () => {
    gerarImagemEDownload('recibo-final', 'Recibo-EliteCar.png');
  });

  btnCompartilharRecibo.addEventListener('click', async () => {
    try {
      const blob = await gerarImagem('recibo-final');
      const file = new File([blob], 'Recibo-EliteCar.png', { type: 'image/png' });
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({
          files: [file],
          title: 'Recibo Elite Car',
          text: 'Segue o recibo gerado no site Elite Car.',
        });
      } else {
        alert('Seu dispositivo não suporta o compartilhamento direto de arquivos.');
      }
    } catch (err) {
      alert('Erro ao tentar compartilhar: ' + err);
    }
  });

  // Função para gerar imagem e disparar download
  async function gerarImagemEDownload(idElemento, nomeArquivo) {
    const elemento = document.getElementById(idElemento);

    // Esconder botões antes de capturar
    esconderBotoes(true);

    const canvas = await html2canvas(elemento, { scale: 2 });
    const link = document.createElement('a');
    link.download = nomeArquivo;
    link.href = canvas.toDataURL('image/png');
    link.click();

    // Mostrar botões depois
    esconderBotoes(false);
  }

  async function gerarImagem(idElemento) {
    const elemento = document.getElementById(idElemento);

    esconderBotoes(true);

    const canvas = await html2canvas(elemento, { scale: 2 });

    esconderBotoes(false);

    return new Promise((resolve) => {
      canvas.toBlob((blob) => resolve(blob));
    });
  }

  function esconderBotoes(ocultar) {
    const botoes = document.querySelectorAll('.no-print');
    botoes.forEach(btn => {
      if (ocultar) {
        btn.classList.add('hide-buttons');
      } else {
        btn.classList.remove('hide-buttons');
      }
    });
  }
</script>

</body>
</html>
