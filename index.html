<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orçamento Elite Car - Estilizado</title>
<style>
  /* Reset básico */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 20px;
    color: #222;
  }

  .orcamento {
    max-width: 900px;
    margin: 0 auto;
    background: #fff;
    border-radius: 14px;
    padding: 30px 40px;
    box-shadow: 0 12px 24px rgba(0,0,0,0.12);
  }

  /* Cabeçalho com logo + título */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 2px solid #27ae60;
    padding-bottom: 12px;
    margin-bottom: 25px;
  }
  .logo-car {
    max-width: 180px;
  }
  .logo-car img {
    max-width: 100%;
    height: auto;
    display: block;
  }
  .header-info {
    text-align: right;
  }
  .header-info h1 {
    margin: 0;
    font-weight: 700;
    font-size: 2.2rem;
    color: #27ae60;
  }
  .header-info p {
    margin: 4px 0 0 0;
    font-weight: 600;
    color: #555;
  }
  .header-info h3 {
    margin: 6px 0 0 0;
    font-weight: 700;
    color: #27ae60;
  }

  /* Dados Cliente + Veículo */
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  .campo {
    display: flex;
    flex-direction: column;
  }
  label {
    font-weight: 600;
    font-size: 0.95rem;
    color: #444;
    margin-bottom: 6px;
  }
  input[type="text"],
  input[type="number"],
  textarea {
    padding: 10px 12px;
    border: 1.8px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus,
  input[type="number"]:focus,
  textarea:focus {
    outline: none;
    border-color: #27ae60;
    box-shadow: 0 0 5px #27ae60aa;
  }
  textarea {
    resize: vertical;
  }

  /* Data e aviso validade */
  .datatime {
    text-align: center;
    font-size: 0.95rem;
    color: #666;
    margin-bottom: 35px;
  }
  .datatime strong {
    color: #27ae60;
  }

  /* Tabela */
  .table-wrapper {
    overflow-x: auto;
    margin-bottom: 20px;
  }
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
    font-size: 1rem;
  }
  thead th {
    background-color: #27ae60;
    color: white;
    font-weight: 700;
    padding: 14px 12px;
    border-radius: 8px 8px 0 0;
    text-align: center;
  }
  tbody tr {
    background-color: #e6f2ea;
    transition: background-color 0.3s ease;
    border-radius: 10px;
  }
  tbody tr:hover {
    background-color: #d1eadb;
  }
  tbody td {
    padding: 12px 14px;
    text-align: center;
    vertical-align: middle;
    color: #2a5d34;
  }
  tbody td input {
    width: 80px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  tbody td input:focus {
    border-color: #27ae60;
    box-shadow: 0 0 5px #27ae60aa;
  }

  /* Botão delete */
  .botao-coluna button {
    background: #e74c3c;
    border: none;
    color: white;
    font-weight: 700;
    font-size: 1.2rem;
    cursor: pointer;
    border-radius: 6px;
    padding: 4px 10px;
    transition: background-color 0.25s ease;
  }
  .botao-coluna button:hover {
    background: #c0392b;
  }

  /* Valor total */
  .total {
    text-align: right;
    font-weight: 800;
    font-size: 1.5rem;
    color: #27ae60;
    margin-top: 10px;
    border-top: 3px solid #27ae60;
    padding-top: 12px;
  }

  /* Controles */
  .controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
  }
  .controls button {
    background-color: #27ae60;
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    border: none;
    border-radius: 8px;
    padding: 12px 28px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
    min-width: 140px;
  }
  .controls button:hover {
    background-color: #219150;
  }

  /* Preview */
  #preview {
    max-width: 900px;
    margin: 30px auto 0 auto;
    text-align: center;
  }
  #preview h3 {
    font-weight: 700;
    color: #27ae60;
  }
  #previewImage {
    margin-top: 20px;
    max-width: 100%;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(39, 174, 96, 0.25);
    display: none;
  }

  /* Responsivo melhorado */
  @media (max-width: 900px) {
    body {
      padding: 15px 10px;
    }
    .orcamento {
      padding: 20px 25px;
      max-width: 100%;
    }
    .header {
      flex-direction: column;
      gap: 12px;
      text-align: center;
    }
    .header-info {
      text-align: center;
    }
    .logo-car {
      max-width: 140px;
      margin: 0 auto;
    }
    .info-grid {
      grid-template-columns: 1fr !important;
      gap: 15px;
    }
    tbody td input {
      width: 60px;
      font-size: 0.9rem;
    }
    .controls button {
      width: 100%;
      font-size: 1.1rem;
      padding: 14px 0;
      min-width: unset;
    }
    .table-wrapper {
      overflow-x: auto;
    }
    .total {
      font-size: 1.3rem;
      text-align: center;
    }
  }

  @media (max-width: 450px) {
    .campo label {
      font-size: 0.9rem;
    }
    input[type="text"],
    input[type="number"],
    textarea {
      font-size: 0.95rem;
      padding: 8px 10px;
    }
    tbody td input {
      width: 50px;
    }
    .header-info h1 {
      font-size: 1.7rem;
    }
    .header-info p, .header-info h3 {
      font-size: 1rem;
    }
    .total {
      font-size: 1.2rem;
    }
  }
</style>
</head>
<body>

<div class="orcamento" id="orcamento">
  <div class="header">
    <div class="logo-car">
      <img src="./img/imgg.avif" alt="EliteCar Logo" />
    </div>
    <div class="header-info">
      <h1>Elite Car</h1>
      <p>Lanternagem e Pintura</p>
      <h3>Orçamento</h3>
    </div>
  </div>

  <!-- Dados do Cliente -->
  <div class="info-grid">
    <div class="campo">
      <label for="cliente">Nome da Cliente</label>
      <input type="text" id="cliente" placeholder="Ex: Maria Silva" />
    </div>
    <div class="campo">
      <label for="cnpj">CNPJ / CPF</label>
      <input type="text" id="cnpj" placeholder="Ex: 000.000.000-00" />
    </div>
    <div class="campo">
      <label for="endereco">Endereço</label>
      <input type="text" id="endereco" placeholder="Rua, número, bairro" />
    </div>
    <div class="campo">
      <label for="telefone">Telefone / WhatsApp</label>
      <input type="text" id="telefone" placeholder="(00) 00000-0000" />
    </div>
  </div>

  <h2 style="color:#27ae60; margin-bottom:12px;">Dados do Veículo</h2>
  <div class="info-grid">
    <div class="campo">
      <label for="modelo">Modelo</label>
      <input type="text" id="modelo" placeholder="Ex: Fiat Toro" />
    </div>
    <div class="campo">
      <label for="placa">Placa</label>
      <input type="text" id="placa" placeholder="Ex: ABC1D23" />
    </div>
    <div class="campo">
      <label for="cor">Cor</label>
      <input type="text" id="cor" placeholder="Ex: Vermelho" />
    </div>
  </div>

  <div class="datatime">
    <p>Data: <span id="data"></span></p>
    <p>Hora: <span id="hora"></span></p>
    <p><strong>Este orçamento é válido por 7 dias.</strong></p>
  </div>

  <div class="table-wrapper">
    <table id="itens" aria-label="Tabela de itens do orçamento">
      <thead>
        <tr>
          <th scope="col">Qtd</th>
          <th scope="col">Descrição</th>
          <th scope="col">Valor Unitário</th>
          <th scope="col">Valor Total</th>
          <th scope="col" class="botao-coluna">Excluir</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="number" min="1" value="1" class="qtd" aria-label="Quantidade do item" /></td>
          <td><input type="text" class="desc" aria-label="Descrição do item" placeholder="Descrição do serviço ou peça" /></td>
          <td><input type="number" min="0" step="0.01" value="0" class="unit" aria-label="Valor unitário do item" /></td>
          <td class="total-item">R$ 0,00</td>
          <td class="botao-coluna">
            <button type="button" aria-label="Excluir item" class="excluir-btn">&times;</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="total" aria-live="polite" aria-atomic="true">
    Total: <span id="total">R$ 0,00</span>
  </div>

  <div class="controls">
    <button id="addItem" type="button">Adicionar Item</button>
    <button id="gerar" type="button">Gerar Orçamento</button>
    <button id="download" type="button" disabled>Baixar Imagem</button>
  </div>
</div>

<div id="preview">
  <h3>Visualização do Orçamento</h3>
  <img id="previewImage" src="" alt="Visualização do orçamento gerado" />
</div>

<!-- Importando html2canvas via CDN -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  // Atualiza data e hora
  function atualizarDataHora() {
    const now = new Date();
    document.getElementById('data').textContent = now.toLocaleDateString('pt-BR');
    document.getElementById('hora').textContent = now.toLocaleTimeString('pt-BR');
  }
  atualizarDataHora();
  setInterval(atualizarDataHora, 60000);

  // Formatar valor em moeda BRL
  function formatarValor(valor) {
    return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  }

  // Atualiza valores totais da tabela
  function atualizarTabela() {
    const tbody = document.querySelector('#itens tbody');
    let totalGeral = 0;
    tbody.querySelectorAll('tr').forEach(row => {
      const qtdInput = row.querySelector('.qtd');
      const unitInput = row.querySelector('.unit');
      const totalItemTd = row.querySelector('.total-item');

      const qtd = Number(qtdInput.value) || 0;
      const unit = Number(unitInput.value) || 0;
      const totalItem = qtd * unit;

      totalItemTd.textContent = formatarValor(totalItem);
      totalGeral += totalItem;
    });

    document.getElementById('total').textContent = formatarValor(totalGeral);
  }

  // Adiciona nova linha na tabela
  document.getElementById('addItem').addEventListener('click', () => {
    const tbody = document.querySelector('#itens tbody');
    const novaLinha = document.createElement('tr');
    novaLinha.innerHTML = `
      <td><input type="number" min="1" value="1" class="qtd" aria-label="Quantidade do item" /></td>
      <td><input type="text" class="desc" aria-label="Descrição do item" placeholder="Descrição do serviço ou peça" /></td>
      <td><input type="number" min="0" step="0.01" value="0" class="unit" aria-label="Valor unitário do item" /></td>
      <td class="total-item">R$ 0,00</td>
      <td class="botao-coluna">
        <button type="button" aria-label="Excluir item" class="excluir-btn">&times;</button>
      </td>
    `;
    tbody.appendChild(novaLinha);
    adicionarEventosLinha(novaLinha);
  });

  // Adiciona eventos nas linhas para atualizar e excluir
  function adicionarEventosLinha(row) {
    row.querySelectorAll('input').forEach(input => {
      input.addEventListener('input', atualizarTabela);
    });
    const btnExcluir = row.querySelector('.excluir-btn');
    btnExcluir.addEventListener('click', () => {
      row.remove();
      atualizarTabela();
    });
  }

  // Inicializa eventos para as linhas já existentes
  document.querySelectorAll('#itens tbody tr').forEach(adicionarEventosLinha);

  // Atualiza a tabela no carregamento
  atualizarTabela();

  let ultimaImagemDataUrl = '';

  // Gera a imagem do orçamento com html2canvas
  document.getElementById('gerar').addEventListener('click', () => {
    const orcamento = document.getElementById('orcamento');

    html2canvas(orcamento, { scale: 2 }).then(canvas => {
      const previewImage = document.getElementById('previewImage');
      ultimaImagemDataUrl = canvas.toDataURL('image/png');
      previewImage.src = ultimaImagemDataUrl;
      previewImage.alt = 'Imagem gerada do orçamento';
      previewImage.style.display = 'block';

      // Habilitar botão de download após gerar a imagem
      document.getElementById('download').disabled = false;

      // Scroll para preview após gerar
      previewImage.scrollIntoView({ behavior: 'smooth' });
    }).catch(err => {
      alert('Erro ao gerar imagem do orçamento: ' + err.message);
    });
  });

  // Download da imagem gerada
  document.getElementById('download').addEventListener('click', () => {
    if (!ultimaImagemDataUrl) {
      alert('Por favor, gere a imagem do orçamento antes de baixar.');
      return;
    }
    const link = document.createElement('a');
    link.href = ultimaImagemDataUrl;
    link.download = 'orcamento-elite-car.png';
    link.click();
  });
</script>

</body>
</html>
