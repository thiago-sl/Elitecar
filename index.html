<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orçamento e Recibo</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: #f4f7f8;
      color: #333;
    }
    header {
      text-align: center;
      padding: 1rem;
      background: #1e88e5;
      color: white;
    }
    main {
      max-width: 900px;
      margin: 20px auto;
      padding: 0 15px 30px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    section {
      border-radius: 10px;
      padding: 20px 30px;
      margin-bottom: 30px;
    }
    h2 {
      color: #1e88e5;
      border-bottom: 2px solid #1e88e5;
      padding-bottom: 5px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }
    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      margin-top: 5px;
      border: 1.5px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      resize: vertical;
    }
    textarea {
      min-height: 60px;
    }
    .flex-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .flex-col-2 {
      flex: 1 1 48%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th,
    td {
      border: 1px solid #ddd;
      padding: 8px 10px;
      text-align: left;
      vertical-align: middle;
    }
    /* Ajustar larguras específicas no orçamento */
    #orcamento table th:nth-child(1) {
      width: 50%;
    }
    /* Item maior */
    #orcamento table th:nth-child(2) {
      width: 15%;
    }
    /* Qtd menor */
    #orcamento table th:nth-child(3),
    #orcamento table th:nth-child(4) {
      width: 17.5%;
    }
    th {
      background: #e3f2fd;
    }
    /* Abreviação da palavra Quantidade para Qtd no orçamento */
    #orcamento table th:nth-child(2) .full {
      display: none;
    }
    #orcamento table th:nth-child(2) .abbr {
      display: inline;
    }
    #orcamento table th:nth-child(1) .abbr {
      display: none;
    }
    #orcamento table th:nth-child(1) .full {
      display: inline;
    }
    /* Para recibo, mantemos Quantidade normal (se existir) */
    .signatures {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 20px;
      flex-wrap: wrap;
    }
    .signature-box {
      flex: 1;
      border-top: 1px solid #999;
      text-align: center;
      padding-top: 8px;
      font-size: 0.9rem;
      color: #555;
      min-width: 140px;
    }
    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    button {
      background: #1e88e5;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 12px 25px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      flex-grow: 1;
      min-width: 140px;
    }
    button:hover {
      background: #1669bb;
    }
    @media print {
      button,
      .no-print {
        display: none !important;
      }
      main {
        box-shadow: none;
        margin: 0;
        border-radius: 0;
      }
      body {
        background: white;
        color: black;
      }
    }
    @media (max-width: 600px) {
      .flex-row {
        flex-direction: column;
      }
      .flex-col-2 {
        flex: 1 1 100%;
      }
      .signatures {
        flex-direction: column;
        gap: 40px;
      }
      .signature-box {
        min-width: 100%;
        margin-bottom: 10px;
      }
      .buttons {
        flex-direction: column;
        gap: 15px;
      }
      button {
        min-width: 100%;
        flex-grow: 0;
      }
      /* Ajuste para colunas da tabela no orçamento no celular */
      #orcamento table th:nth-child(1) {
        width: 60%;
      }
      #orcamento table th:nth-child(2) {
        width: 10%;
      }
      #orcamento table th:nth-child(3),
      #orcamento table th:nth-child(4) {
        width: 20%;
      }
      /* Mostrar abreviações */
      #orcamento table th:nth-child(2) .full {
        display: none;
      }
      #orcamento table th:nth-child(2) .abbr {
        display: inline;
      }
      #orcamento table th:nth-child(1) .abbr {
        display: none;
      }
      #orcamento table th:nth-child(1) .full {
        display: inline;
      }
    }
    .logo {
      display: block;
      max-width: 150px;
      margin: 0 auto 20px;
    }
    h1 {
      text-align: center;
    }
    
  </style>
</head>
<body>
  <header>
    <h1>Elite Car Orçamento e Recibo</h1>
  </header>

  <main>
    <!-- ORÇAMENTO -->
    <section id="orcamento">
      <img src="./img/imgg.avif" alt="Logo da Empresa" class="logo" />
      <h1>Elite Car</h1>
      <h2>Orçamento</h2>

      <label for="empresaNome">Nome da empresa</label>
      <input type="text" id="empresaNome" value="Elite Car ." />

      <label for="empresaEndereco">Endereço da empresa</label>
      <input type="text" id="empresaEndereco" value="Qr3 Conjunto N Casa 6" />

      <label for="empresaTelefone">Telefone da empresa</label>
      <input type="text" id="empresaTelefone" value="(61) 98163-7286" />

      <label for="clienteNome">Nome do cliente</label>
      <input type="text" id="clienteNome" />

      <!-- Novos campos do veículo -->
      <div class="flex-row">
        <div class="flex-col-2">
          <label for="veiculoModelo">Modelo do veículo</label>
          <input type="text" id="veiculoModelo" placeholder="Ex: Ford Ka" />
        </div>
        <div class="flex-col-2">
          <label for="veiculoCor">Cor do veículo</label>
          <input type="text" id="veiculoCor" placeholder="Ex: Vermelho" />
        </div>
      </div>
      <label for="veiculoPlaca">Placa do veículo</label>
      <input type="text" id="veiculoPlaca" placeholder="Ex: ABC-1234" />

      <label for="dataOrcamento">Data</label>
      <input type="text" id="dataOrcamento" readonly />

      <label for="horaOrcamento">Hora</label>
      <input type="text" id="horaOrcamento" readonly />


      <table id="itensTabela">
        <thead>
          <tr>
            <th><span class="full">Item</span><span class="abbr">Item</span></th>
            <th><span class="full">Quantidade</span><span class="abbr">Qtd</span></th>
            <th>Preço Unitário</th>
            <th>Total</th>
          </tr>
          
        </thead>
        <tbody>
          <tr>
            <td>
              <input type="text" class="item-desc" placeholder="Descrição" />
            </td>
            <td>
              <input type="number" class="item-quant" min="1" value="1" />
            </td>
            <td>
              <input type="number" class="item-preco" min="0" step="0.01" value="0.00" />
            </td>
            <td>
              <input type="text" class="item-total" readonly value="0.00" />
            </td>
          </tr>
        </tbody>
      </table>

      <button id="adicionarItem">Adicionar Item</button>

      <h3>Total Geral: R$ <span id="totalGeral">0.00</span></h3>
  


      <!-- Botão gerar orçamento dentro do orçamento -->
      <div class="buttons">
        <button id="gerarOrcamento">Gerar Orçamento</button>
      </div>
      
    </section>

    <!-- RECIBO -->
    <section id="recibo">
      <h2>Recibo</h2>

      <label for="reciboEmpresaNome">Nome da empresa</label>
      <input type="text" id="reciboEmpresaNome" value="Elite Car" />
 <label for="empresaEndereco">Endereço da empresa</label>
      <input type="text" id="empresaEndereco" value="Qr3 Conjunto N Casa 6" />
      <label for="empresaTelefone">Telefone da empresa</label>
      <input type="text" id="empresaTelefone" value="(61) 98163-7286" />

      <label for="reciboClienteNome">Nome do cliente</label>
      <input type="text" id="reciboClienteNome" />

      <!-- Campo Valor Total (não editável, mas pode editar se quiser) -->
      <label for="reciboValorTotal">Valor total do Orçamento</label>
      <input type="number" id="reciboValorTotal" min="0" step="0.01" value="0.00" />

      <!-- Valor de entrada (valor pago agora) -->
      <label for="reciboValorEntrada">Valor de entrada</label>
      <input type="number" id="reciboValorEntrada" min="0" step="0.01" value="0.00" />

      <!-- Valor restante (total - entrada) readonly -->
      <label for="reciboValorRestante">Valor restante</label>
      <input type="number" id="reciboValorRestante" readonly value="0.00" />

      <!-- Opção de pagamento -->
      <label for="reciboFormaPagamento">Forma de pagamento</label>
      <select id="reciboFormaPagamento">
        <option value="dinheiro">Dinheiro</option>
        <option value="debito">Débito</option>
        <option value="credito">Crédito</option>
        <option value="pix">Pix</option>
      </select>

      <label for="reciboData">Data</label>
      <input type="text" id="reciboData" readonly />

      <label for="reciboHora">Hora</label>
      <input type="text" id="reciboHora" readonly />

      <!-- Botão gerar recibo dentro do recibo -->
      <div class="buttons">
        <button id="gerarRecibo">Gerar Recibo</button>
      </div>
    </section>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Função para preencher data e hora nos dois formulários
    function preencherDataHora() {
      const now = new Date();
      const dataFormatada = now.toLocaleDateString('pt-BR');
      const horaFormatada = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

      document.getElementById('dataOrcamento').value = dataFormatada;
      document.getElementById('horaOrcamento').value = horaFormatada;

      document.getElementById('reciboData').value = dataFormatada;
      document.getElementById('reciboHora').value = horaFormatada;
    }
    preencherDataHora();

    // Atualizar total dos itens no orçamento
    function atualizarTotais() {
      const linhas = document.querySelectorAll('#itensTabela tbody tr');
      let totalGeral = 0;

      linhas.forEach((linha) => {
        const quantidade = parseInt(linha.querySelector('.item-quant').value) || 0;
        const precoUnit = parseFloat(linha.querySelector('.item-preco').value) || 0;
        const total = quantidade * precoUnit;
        linha.querySelector('.item-total').value = total.toFixed(2);
        totalGeral += total;
      });

      document.getElementById('totalGeral').textContent = totalGeral.toFixed(2);

   
      // Atualizar valor total do recibo automaticamente quando orçamento mudar
      document.getElementById('reciboValorTotal').value = totalGeral.toFixed(2);

      // Atualizar valor restante no recibo também
      atualizarValorRestante();
    }

    // Atualizar valor restante no recibo (total - entrada)
    function atualizarValorRestante() {
      const total = parseFloat(document.getElementById('reciboValorTotal').value) || 0;
      const entrada = parseFloat(document.getElementById('reciboValorEntrada').value) || 0;
      let restante = total - entrada;
      if (restante < 0) restante = 0;
      document.getElementById('reciboValorRestante').value = restante.toFixed(2);
    }

    // Event listeners para atualizar totais e valor restante
    document.getElementById('itensTabela').addEventListener('input', function (e) {
      if (e.target.classList.contains('item-quant') || e.target.classList.contains('item-preco')) {
        atualizarTotais();
      }
    });

    document.getElementById('reciboValorEntrada').addEventListener('input', atualizarValorRestante);
    document.getElementById('reciboValorTotal').addEventListener('input', atualizarValorRestante);

    // Botão adicionar item
    document.getElementById('adicionarItem').addEventListener('click', () => {
      const tbody = document.querySelector('#itensTabela tbody');
      const novaLinha = document.createElement('tr');
      novaLinha.innerHTML = `
        <td><input type="text" class="item-desc" placeholder="Descrição" /></td>
        <td><input type="number" class="item-quant" min="1" value="1" /></td>
        <td><input type="number" class="item-preco" min="0" step="0.01" value="0.00" /></td>
        <td><input type="text" class="item-total" readonly value="0.00" /></td>
      `;
      tbody.appendChild(novaLinha);
    });

    // Função gerar orçamento PDF (mantido original)
    async function gerarPdfOrcamento() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const empresaNome = document.getElementById('empresaNome').value.trim();
      const empresaEndereco = document.getElementById('empresaEndereco').value.trim();
      const empresaTelefone = document.getElementById('empresaTelefone').value.trim();
      const clienteNome = document.getElementById('clienteNome').value.trim();
      const veiculoModelo = document.getElementById('veiculoModelo').value.trim();
      const veiculoCor = document.getElementById('veiculoCor').value.trim();
      const veiculoPlaca = document.getElementById('veiculoPlaca').value.trim();
      const data = document.getElementById('dataOrcamento').value;
      const hora = document.getElementById('horaOrcamento').value;
      
      doc.setFontSize(16);
      doc.text(empresaNome, 14, 20);
      doc.setFontSize(11);
      doc.text(empresaEndereco, 14, 27);
      doc.text('Tel: ' + empresaTelefone, 14, 33);

      doc.setFontSize(13);
      doc.text('ORÇAMENTO', 105, 45, null, null, 'center');

      doc.setFontSize(11);
      doc.text(`Cliente: ${clienteNome}`, 14, 55);
      doc.text(`Modelo do veículo: ${veiculoModelo}`, 14, 61);
      doc.text(`Cor do veículo: ${veiculoCor}`, 14, 67);
      doc.text(`Placa do veículo: ${veiculoPlaca}`, 14, 73);
      doc.text(`Data: ${data}`, 150, 55);
      doc.text(`Hora: ${hora}`, 150, 61);
    
     

      // Cabeçalho da tabela
      const startY = 85;
      doc.setFillColor(227, 242, 253);
      doc.rect(10, startY - 11, 185, 5, 'F'); // fundo azul claro
      doc.setTextColor(0);
      doc.setFont(undefined, 'bold');
      doc.text('Item', 16, startY - 7);
      doc.text('Qtd', 112, startY - 7);
      doc.text('Preço Unit.', 140, startY - 7);
      doc.text('Total', 175, startY - 7);
      doc.setFont(undefined, 'normal');

      let posY = startY;

      const linhas = document.querySelectorAll('#itensTabela tbody tr');

      linhas.forEach((linha) => {
        const desc = linha.querySelector('.item-desc').value.trim();
        const quant = linha.querySelector('.item-quant').value;
        const precoUnit = linha.querySelector('.item-preco').value;
        const total = linha.querySelector('.item-total').value;


        if (!desc) return; // pular itens sem descrição

        if (posY > 260) {
          doc.addPage();
          posY = 20;
        }

        doc.text(desc, 16, posY);
        doc.text(quant.toString(), 115, posY);
        doc.text(`R$ ${parseFloat(precoUnit).toFixed(2)}`, 140, posY);
        doc.text(`R$ ${parseFloat(total).toFixed(2)}`, 175, posY);

        posY += 8;
      });

      // Total geral
      const totalGeral = parseFloat(document.getElementById('totalGeral').textContent) || 0;
      if (posY + 15 > 290) {
        doc.addPage();
        posY = 20;
      }
      doc.setFont(undefined, 'bold');
      doc.text(`Total Geral: R$ ${totalGeral.toFixed(2)}`, 14, posY + 15);

      doc.save('orcamento.pdf');
    }

    // Função gerar recibo PDF (modificada para incluir forma de pagamento, valores, etc)
    async function gerarPdfRecibo() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const empresaNome = document.getElementById('reciboEmpresaNome').value.trim();
      const empresaEndereco = document.getElementById('empresaEndereco').value.trim();
      const empresaTelefone = document.getElementById('empresaTelefone').value.trim();
      const clienteNome = document.getElementById('reciboClienteNome').value.trim();
      const valorTotalInput = document.getElementById('reciboValorTotal').value;
      const valorEntradaInput = document.getElementById('reciboValorEntrada').value;
      const valorRestanteInput = document.getElementById('reciboValorRestante').value;
      const formaPagamento = document.getElementById('reciboFormaPagamento').value;
      const data = document.getElementById('reciboData').value;
      const hora = document.getElementById('reciboHora').value;

      // Formatar valores para moeda BRL
      function formatarValor(valor) {
        const num = parseFloat(valor);
        return isNaN(num) ? '0,00' : num.toFixed(2).replace('.', ',');
      }

      const valorTotal = formatarValor(valorTotalInput);
      const valorEntrada = formatarValor(valorEntradaInput);
      const valorRestante = formatarValor(valorRestanteInput);

      // Traduzir forma de pagamento
      const formasPagamentoTexto = {
        dinheiro: 'Dinheiro',
        debito: 'Débito',
        credito: 'Crédito',
        pix: 'Pix',
      };
      const formaPagamentoTexto = formasPagamentoTexto[formaPagamento] || '';

       doc.setFontSize(16);
      doc.text(empresaNome, 14, 20);
      doc.setFontSize(11);
      doc.text(empresaEndereco, 14, 27);
      doc.text('Tel: ' + empresaTelefone, 14, 33);

      doc.setFontSize(13);
      doc.text('RECIBO', 105, 40, null, null, 'center');

      doc.setFontSize(11);
      doc.text(`Cliente: ${clienteNome}`, 14, 60);
      doc.text(`Valor total do Orçamento: R$ ${valorTotal}`, 14, 68);
      doc.text(`Valor de entrada : R$ ${valorEntrada}`, 14, 76);
      doc.text(`Valor restante: R$ ${valorRestante}`, 14, 84);
      doc.text(`Forma de pagamento: ${formaPagamentoTexto}`, 14, 92);
      doc.text(`Data: ${data}`, 14, 100);
      doc.text(`Hora: ${hora}`, 14, 108);

      doc.text('Assinatura do cliente:', 14, 140);
      doc.line(14, 142, 90, 142); // linha para assinatura cliente

      doc.text('Assinatura da empresa:', 110, 140);
      doc.line(110, 142, 190, 142); // linha para assinatura empresa

      doc.save('recibo.pdf');
    }

    // Eventos para gerar PDFs
    document.getElementById('gerarOrcamento').addEventListener('click', gerarPdfOrcamento);
    document.getElementById('gerarRecibo').addEventListener('click', gerarPdfRecibo);

    // Atualiza totais iniciais para garantir dados coerentes
    atualizarTotais();
    
  </script>
</body>
</html>
