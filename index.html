<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orçamento e Recibo</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: #f4f7f8;
      color: #333;
    }

    header {
      text-align: center;
      padding: 1rem;
      background: #1e88e5;
      color: white;
    }

    main {
      max-width: 900px;
      margin: 20px auto;
      padding: 0 15px 30px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    section {
      border-radius: 10px;
      padding: 20px 30px;
      margin-bottom: 30px;
    }

    h2 {
      color: #1e88e5;
      border-bottom: 2px solid #1e88e5;
      padding-bottom: 5px;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      margin-top: 5px;
      border: 1.5px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      resize: vertical;
    }

    textarea { min-height: 60px; }

    .flex-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .flex-col-2 {
      flex: 1 1 48%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px 10px;
      text-align: left;
    }

    th {
      background: #e3f2fd;
    }

    th .abbr { display: none; }
    th .full { display: inline; }

    .signatures {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 20px;
      flex-wrap: wrap;
    }

    .signature-box {
      flex: 1;
      border-top: 1px solid #999;
      text-align: center;
      padding-top: 8px;
      font-size: 0.9rem;
      color: #555;
      min-width: 140px;
    }

    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    button {
      background: #1e88e5;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 12px 25px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      flex-grow: 1;
      min-width: 140px;
    }

    button:hover { background: #1669bb; }

    @media print {
      button, .no-print { display: none !important; }
      main {
        box-shadow: none;
        margin: 0;
        border-radius: 0;
      }
      body {
        background: white;
        color: black;
      }
    }

    @media (max-width: 600px) {
      .flex-row { flex-direction: column; }
      .flex-col-2 { flex: 1 1 100%; }
      .signatures { flex-direction: column; gap: 40px; }
      .signature-box { min-width: 100%; margin-bottom: 10px; }
      .buttons { flex-direction: column; gap: 15px; }
      button { min-width: 100%; flex-grow: 0; }
      th .full { display: none; }
      th .abbr { display: inline; }
    }

    .logo {
      display: block;
      max-width: 150px;
      margin: 0 auto 20px;
    }
    h1{
      text-align: center;
    }
  </style>
</head>
<body>
<header>
  <h1>Elite Car Orçamento e Recibo</h1>
</header>

<main>
  <!-- ORÇAMENTO -->
  <section id="orcamento">
    <img src="./img/imgg.avif" alt="Logo da Empresa" class="logo" />
    <h1>Elite Car</h1>
    <h2>Orçamento</h2>

    <label for="empresaNome">Nome da empresa</label>
    <input type="text" id="empresaNome" value="Elite Car ." />

    <label for="empresaEndereco">Endereço da empresa</label>
    <input type="text" id="empresaEndereco" value="Qr3 Conjunto N Casa 6" />

    <label for="empresaTelefone">Telefone da empresa</label>
    <input type="text" id="empresaTelefone" value="(61) 98163-7286" />

    <label for="clienteNome">Nome do cliente</label>
    <input type="text" id="clienteNome" />

    <!-- Novos campos do veículo -->
    <div class="flex-row">
      <div class="flex-col-2">
        <label for="veiculoModelo">Modelo do veículo</label>
        <input type="text" id="veiculoModelo" placeholder="Ex: Ford Ka" />
      </div>
      <div class="flex-col-2">
        <label for="veiculoCor">Cor do veículo</label>
        <input type="text" id="veiculoCor" placeholder="Ex: Vermelho" />
      </div>
    </div>
    <label for="veiculoPlaca">Placa do veículo</label>
    <input type="text" id="veiculoPlaca" placeholder="Ex: ABC-1234" />

    <label for="dataOrcamento">Data</label>
    <input type="text" id="dataOrcamento" readonly />

    <label for="horaOrcamento">Hora</label>
    <input type="text" id="horaOrcamento" readonly />

    <table id="itensTabela">
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantidade</th>
          <th>Preço Unitário</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" class="item-desc" placeholder="Descrição" /></td>
          <td><input type="number" class="item-quant" min="1" value="1" /></td>
          <td><input type="number" class="item-preco" min="0" step="0.01" value="0.00" /></td>
          <td class="item-total">0.00</td>
        </tr>
      </tbody>
    </table>
    <button id="addItemBtn" class="no-print">Adicionar Item</button>

    <label for="observacoesOrcamento" style="margin-top: 25px;">Observações</label>
    <textarea id="observacoesOrcamento" placeholder="Escreva aqui observações adicionais..."></textarea>

    <p><strong>Total: R$ <span id="totalOrcamento">0.00</span></strong></p>

    <div class="signatures">
      <div class="signature-box">Assinatura do cliente</div>
      <div class="signature-box">Assinatura da empresa</div>
    </div>

    <div class="buttons">
      <button id="baixarPdfOrcamento" class="no-print">Baixar PDF</button>
      <button id="imprimirOrcamento" class="no-print">Imprimir</button>
      <button id="compartilharOrcamento" class="no-print">Compartilhar</button>
    </div>
  </section>

  <!-- RECIBO -->
  <section id="recibo">
    <img src="./img/imgg.avif" alt="Logo da Empresa" class="logo" />
    <h1>Elite Car</h1>
    <h2>Recibo</h2>

    <label for="empresaNomeRecibo">Nome da empresa</label>
    <input type="text" id="empresaNomeRecibo" value="Elite Car." />

    <label for="empresaEnderecoRecibo">Endereço da empresa</label>
    <input type="text" id="empresaEnderecoRecibo" value="Qr3 Conjunto N Casa 6" />

    <label for="empresaTelefoneRecibo">Telefone da empresa</label>
    <input type="text" id="empresaTelefoneRecibo" value="(61) 98163-7286" />

    <label for="clienteNomeRecibo">Nome do cliente</label>
    <input type="text" id="clienteNomeRecibo" />

    <label for="dataRecibo">Data</label>
    <input type="text" id="dataRecibo" readonly />

    <label for="horaRecibo">Hora</label>
    <input type="text" id="horaRecibo" readonly />

    <label for="valorTotalRecibo">Valor total</label>
    <input type="number" id="valorTotalRecibo" min="0" step="0.01" value="0.00" />

    <label for="valorEntradaRecibo">Valor entrada</label>
    <input type="number" id="valorEntradaRecibo" min="0" step="0.01" value="0.00" />

    <label for="valorRestanteRecibo">Valor restante</label>
    <input type="number" id="valorRestanteRecibo" readonly />

    <label for="descricaoRecibo">Descrição</label>
    <textarea id="descricaoRecibo"></textarea>

    <div class="signatures">
      <div class="signature-box">Assinatura do cliente</div>
      <div class="signature-box">Assinatura da empresa</div>
    </div>

    <div class="buttons">
      <button id="baixarPdfRecibo" class="no-print">Baixar PDF</button>
      <button id="imprimirRecibo" class="no-print">Imprimir</button>
      <button id="compartilharRecibo" class="no-print">Compartilhar</button>
    </div>
  </section>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  function atualizarDataHora() {
    const agora = new Date();
    const data = agora.toLocaleDateString('pt-BR');
    const hora = agora.toLocaleTimeString('pt-BR', { hour12: false });
    document.getElementById('dataOrcamento').value = data;
    document.getElementById('horaOrcamento').value = hora;
    document.getElementById('dataRecibo').value = data;
    document.getElementById('horaRecibo').value = hora;
  }
  atualizarDataHora();
  setInterval(atualizarDataHora, 60000);

  function atualizarTotalOrcamento() {
    let total = 0;
    document.querySelectorAll('#itensTabela tbody tr').forEach(row => {
      const q = +row.querySelector('.item-quant').value || 0;
      const p = +row.querySelector('.item-preco').value || 0;
      const t = q * p;
      row.querySelector('.item-total').textContent = t.toFixed(2);
      total += t;
    });
    document.getElementById('totalOrcamento').textContent = total.toFixed(2);
  }

  document.getElementById('addItemBtn').onclick = () => {
    const tbody = document.querySelector('#itensTabela tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" class="item-desc" placeholder="Descrição" /></td>
      <td><input type="number" class="item-quant" min="1" value="1" /></td>
      <td><input type="number" class="item-preco" min="0" step="0.01" value="0.00" /></td>
      <td class="item-total">0.00</td>
    `;
    tbody.appendChild(tr);
    tr.querySelectorAll('.item-quant, .item-preco').forEach(i => i.oninput = atualizarTotalOrcamento);
  };

  document.querySelectorAll('.item-quant, .item-preco').forEach(i => i.oninput = atualizarTotalOrcamento);
  atualizarTotalOrcamento();

  function atualizarValorRestante() {
    const t = +document.getElementById('valorTotalRecibo').value || 0;
    const e = +document.getElementById('valorEntradaRecibo').value || 0;
    document.getElementById('valorRestanteRecibo').value = (t - e).toFixed(2);
  }

  document.getElementById('valorTotalRecibo').oninput = atualizarValorRestante;
  document.getElementById('valorEntradaRecibo').oninput = atualizarValorRestante;
  atualizarValorRestante();

  async function gerarPdf(elementId) {
    const element = document.getElementById(elementId);

    // Esconde botões para não aparecerem no PDF
    document.querySelectorAll(`#${elementId} .no-print`).forEach(b => b.style.display = 'none');

    const canvas = await html2canvas(element, { scale: 2, useCORS: true, scrollY: -window.scrollY });
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');

    // Calcula dimensões para caber A4 mantendo proporção
    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    let position = 0;

    if (pdfHeight <= pdf.internal.pageSize.getHeight()) {
      pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
    } else {
      // Multi-página
      let canvasHeight = canvas.height;
      let pageHeightPx = (canvas.width * pdf.internal.pageSize.getHeight()) / pdfWidth;
      let renderedHeight = 0;

      while (renderedHeight < canvasHeight) {
        const pageCanvas = document.createElement('canvas');
        pageCanvas.width = canvas.width;
        pageCanvas.height = Math.min(pageHeightPx, canvasHeight - renderedHeight);

        const ctx = pageCanvas.getContext('2d');
        ctx.drawImage(
          canvas,
          0,
          renderedHeight,
          canvas.width,
          pageCanvas.height,
          0,
          0,
          canvas.width,
          pageCanvas.height
        );

        const pageData = pageCanvas.toDataURL('image/png');
        if (renderedHeight > 0) pdf.addPage();
        pdf.addImage(pageData, 'PNG', 0, 0, pdfWidth, (pageCanvas.height * pdfWidth) / canvas.width);

        renderedHeight += pageHeightPx;
      }
    }

    // Restaura visibilidade dos botões
    document.querySelectorAll(`#${elementId} .no-print`).forEach(b => b.style.display = '');

    pdf.save(elementId + '.pdf');
  }

  document.getElementById('baixarPdfOrcamento').onclick = () => gerarPdf('orcamento');
  document.getElementById('baixarPdfRecibo').onclick = () => gerarPdf('recibo');

  document.getElementById('imprimirOrcamento').onclick = () => {
    window.print();
  };
  document.getElementById('imprimirRecibo').onclick = () => {
    window.print();
  };

  function compartilharOrcamento() {
    const empresa = document.getElementById('empresaNome').value.trim();
    const endereco = document.getElementById('empresaEndereco').value.trim();
    const telefone = document.getElementById('empresaTelefone').value.trim();
    const cliente = document.getElementById('clienteNome').value.trim();
    const modelo = document.getElementById('veiculoModelo').value.trim();
    const cor = document.getElementById('veiculoCor').value.trim();
    const placa = document.getElementById('veiculoPlaca').value.trim();
    const obs = document.getElementById('observacoesOrcamento').value.trim();
    const total = document.getElementById('totalOrcamento').textContent.trim();
    const data = document.getElementById('dataOrcamento').value;
    const hora = document.getElementById('horaOrcamento').value;

    let itens = '';
    document.querySelectorAll('#itensTabela tbody tr').forEach((row, i) => {
      const desc = row.querySelector('.item-desc').value.trim();
      const q = row.querySelector('.item-quant').value.trim();
      const p = row.querySelector('.item-preco').value.trim();
      const t = row.querySelector('.item-total').textContent.trim();
      if(desc) {
        itens += `\n  ${i + 1}. ${desc} - Quant: ${q} - Unitário: R$ ${p} - Total: R$ ${t}`;
      }
    });

    const texto = 
`Orçamento - ${empresa}
Endereço: ${endereco}
Telefone: ${telefone}
Data: ${data} Hora: ${hora}

Cliente: ${cliente}
Veículo: Modelo: ${modelo}, Cor: ${cor}, Placa: ${placa}

Itens:
${itens}

Observações:
${obs}

Total: R$ ${total}`;

    if (navigator.share) {
      navigator.share({
        title: `Orçamento - ${empresa}`,
        text: texto,
      }).catch(console.error);
    } else {
      alert('Compartilhamento não suportado neste navegador.');
    }
  }

  function compartilharRecibo() {
    const empresa = document.getElementById('empresaNomeRecibo').value.trim();
    const endereco = document.getElementById('empresaEnderecoRecibo').value.trim();
    const telefone = document.getElementById('empresaTelefoneRecibo').value.trim();
    const cliente = document.getElementById('clienteNomeRecibo').value.trim();
    const data = document.getElementById('dataRecibo').value;
    const hora = document.getElementById('horaRecibo').value;
    const valorTotal = document.getElementById('valorTotalRecibo').value;
    const valorEntrada = document.getElementById('valorEntradaRecibo').value;
    const valorRestante = document.getElementById('valorRestanteRecibo').value;
    const descricao = document.getElementById('descricaoRecibo').value.trim();

    const texto = 
`Recibo - ${empresa}
Endereço: ${endereco}
Telefone: ${telefone}
Data: ${data} Hora: ${hora}

Cliente: ${cliente}

Descrição:
${descricao}

Valor total: R$ ${valorTotal}
Valor entrada: R$ ${valorEntrada}
Valor restante: R$ ${valorRestante}`;

    if (navigator.share) {
      navigator.share({
        title: `Recibo - ${empresa}`,
        text: texto,
      }).catch(console.error);
    } else {
      alert('Compartilhamento não suportado neste navegador.');
    }
  }

  document.getElementById('compartilharOrcamento').onclick = compartilharOrcamento;
  document.getElementById('compartilharRecibo').onclick = compartilharRecibo;
</script>
</body>
</html>
