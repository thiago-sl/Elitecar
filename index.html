<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Or√ßamento</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
      padding: 10px;
    }

    .orcamento {
      background: white;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1, h3, p {
      text-align: center;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }

    .logo-car {
      width: 200px;
      margin: auto;
      margin-bottom: 5px;
    }

    .logo {
      height: 100px;
      display: block;
      margin: 0 auto 0;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .info.cliente {
      grid-template-columns: repeat(2, 1fr);
    }

    .info.veiculo {
      grid-template-columns: repeat(3, 1fr);
    }

    .datatime {
      margin-top: 10px;
      font-size: 0.95rem;
      text-align: center;
    }

    .table-wrapper {
      display: flex;
      justify-content: center;
      margin: 15px 0;
    }

    table {
      width: 100%;
      max-width: 800px;
      border-collapse: collapse;
    }

    table th, table td {
      border: 1px solid #ccc;
      background-color: #27ae60;
      padding: 8px;
      text-align: center;
      font-size: 0.9rem;
    }

    .total {
      font-weight: bold;
      text-align: right;
      font-size: 1.1rem;
      margin-top: 10px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    .controls button {
      padding: 10px 15px;
      background-color: #27ae60;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 600px) {
      .info.cliente, .info.veiculo {
        grid-template-columns: 1fr;
      }

      table th, table td {
        font-size: 0.8rem;
        padding: 6px;
      }

      .controls button {
        width: 100%;
      }
    }

    #preview {
      text-align: center;
      margin-top: 30px;
    }

    #previewImage {
      max-width: 600px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin: 20px auto;
    }
    .download-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
}

  </style>
</head>
<body>

<div class="orcamento" id="orcamento">
  <div class="logo-car">
    <img src="./img/imgg.avif" alt="EliteCar Logo" class="logo">
  </div>

  <h1>Elite Car</h1>
  <p>Lanternagem e Pintura</p>
  <h3>Or√ßamento</h3>

  <!-- Dados do Cliente -->
  <div class="info cliente">
    <input type="text" placeholder="Nome da Cliente" id="cliente">
    <input type="text" placeholder="CNPJ / CPF" id="cnpj">
    <input type="text" placeholder="Endere√ßo" id="endereco">
    <input type="text" placeholder="Telefone / WhatsApp" id="telefone">
  </div>
   <h1>Dados do Veiculo</h1>
  <!-- Dados do Ve√≠culo -->
  <div class="info veiculo">
   
    <input type="text" placeholder="Modelo" id="modelo">
    <input type="text" placeholder="Placa" id="placa">
     <input type="text" placeholder="Cor" id="cor">
  </div>

  <div class="datatime">
    <p>Data: <span id="data"></span></p>
    <p>Hora: <span id="hora"></span></p>
    <p><strong>Este or√ßamento √© v√°lido por 7 dias.</strong></p>
  </div>

  <div class="table-wrapper">
    <table id="itens">
      <thead>
        <tr>
          <th>Qtd</th>
          <th>Descri√ß√£o</th>
          <th>Valor Unit√°rio</th>
          <th>Total</th>
          <th class="botao-coluna">A√ß√£o</th>
        </tr>
      </thead>
      <tbody id="listaItens"></tbody>
    </table>
  </div>

  <div class="controls">
    <button onclick="adicionarItem()">Adicionar Item</button>
  </div>

  <div id="obsWrapper">
    <p><strong>Observa√ß√µes:</strong></p>
    <textarea id="obs" placeholder="Observa√ß√µes..." rows="4"></textarea>
  </div>

  <div id="assinaturaWrapper">
    <input type="text" id="assinatura" placeholder="Assinatura do Respons√°vel">
  </div>

  <div class="controls" id="controles">
    <button onclick="gerarOrcamento()">Gerar Pr√©-visualiza√ß√£o</button>
  </div>
</div>
<div class="controls download-buttons">
  <button onclick="baixarImagem()">Confirmar e Baixar JPG</button>
  <button onclick="compartilharOrcamento()">Compartilhar</button>
  <button onclick="voltarEdicao()">Editar Novamente</button>
</div>


<!-- √Årea de visualiza√ß√£o -->
<div id="preview" class="hidden">
  <h3>Pr√©-visualiza√ß√£o do Or√ßamento</h3>
  <img id="previewImage" src="" alt="Pr√©via do or√ßamento gerado">
  <div class="controls">
    <button onclick="baixarImagem()">Confirmar e Baixar JPG</button>
    <button onclick="compartilharOrcamento()">Compartilhar</button>
    <button onclick="voltarEdicao()">Editar Novamente</button>
  </div>
</div>

<!-- html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
  function atualizarDataHora() {
    const agora = new Date();
    document.getElementById('data').innerText = agora.toLocaleDateString();
    document.getElementById('hora').innerText = agora.toLocaleTimeString();
  }

  function adicionarItem() {
    const tbody = document.getElementById('listaItens');
    const linha = document.createElement('tr');

    linha.innerHTML = `
      <td><input type="number" value="1" min="1" onchange="calcularTotal()"></td>
      <td><input type="text" placeholder="Descri√ß√£o"></td>
      <td><input type="number" value="0" min="0" onchange="calcularTotal()"></td>
      <td>R$ 0.00</td>
      <td class="botao-coluna"><button onclick="this.closest('tr').remove(); calcularTotal();">üóëÔ∏è</button></td>
    `;

    tbody.appendChild(linha);
    calcularTotal();
  }

  function calcularTotal() {
    let total = 0;
    const linhas = document.querySelectorAll('#listaItens tr');
    linhas.forEach(linha => {
      const qtd = parseFloat(linha.children[0].querySelector('input').value) || 0;
      const valor = parseFloat(linha.children[2].querySelector('input').value) || 0;
      const subtotal = qtd * valor;
      linha.children[3].innerText = 'R$ ' + subtotal.toFixed(2);
      total += subtotal;
    });

    let valorTotalEl = document.getElementById('valorTotal');
    if (valorTotalEl) {
      valorTotalEl.innerText = total.toFixed(2);
    }
  }
  async function gerarOrcamento() {
  if (!validarCampos()) return;

  document.getElementById('controles').classList.add('hidden');
  document.querySelectorAll('.botao-coluna, .botao-coluna button').forEach(el => el.classList.add('hidden'));
  document.querySelector('.controls button[onclick="adicionarItem()"]').classList.add('hidden');

  // Oculta os bot√µes temporariamente durante a captura
  const botoesDownload = document.querySelector('.download-buttons');
  botoesDownload.style.display = 'none';

  const canvas = await html2canvas(document.querySelector("#orcamento"), { scale: 0.7 });

  // Restaura os bot√µes ap√≥s a captura
  botoesDownload.style.display = 'flex';

  document.getElementById('previewImage').src = canvas.toDataURL("image/jpeg");

  document.getElementById('orcamento').classList.add('hidden');
  document.getElementById('preview').classList.remove('hidden');
}


  function validarCampos() {
    const campos = ['cliente', 'cnpj', 'endereco', 'telefone', 'assinatura', 'cor', 'modelo', 'placa'];
    for (const id of campos) {
      const el = document.getElementById(id);
      if (!el.value.trim()) {
        alert(`Preencha o campo: ${el.placeholder}`);
        el.focus();
        return false;
      }
    }

    const linhas = document.querySelectorAll('#listaItens tr');
    if (linhas.length === 0) {
      alert('Adicione pelo menos um item ao or√ßamento.');
      return false;
    }

    for (const linha of linhas) {
      const qtd = linha.children[0].querySelector('input').value;
      const desc = linha.children[1].querySelector('input').value;
      const val = linha.children[2].querySelector('input').value;

      if (!qtd || !desc.trim() || !val) {
        alert('Todos os campos dos itens devem estar preenchidos.');
        return false;
      }
    }

    return true;
  }

  async function gerarOrcamento() {
    if (!validarCampos()) return;

    document.getElementById('controles').classList.add('hidden');
    document.querySelectorAll('.botao-coluna, .botao-coluna button').forEach(el => el.classList.add('hidden'));
    document.querySelector('.controls button[onclick="adicionarItem()"]').classList.add('hidden');

    const inputsTabela = document.querySelectorAll('#listaItens input');
    inputsTabela.forEach(input => {
      const td = input.parentElement;
      td.innerHTML = input.value;
    });

    ['cliente', 'cnpj', 'endereco', 'telefone', 'cor', 'modelo', 'placa'].forEach(id => {
      const el = document.getElementById(id);
      const valor = el.value;
      const parent = el.parentElement;
      parent.innerHTML = `<p><strong>${el.placeholder}:</strong> ${valor}</p>`;
    });

    const assinatura = document.getElementById('assinatura').value;
    const assinaturaWrapper = document.getElementById('assinaturaWrapper');
    assinaturaWrapper.innerHTML = `<p><strong>Assinatura:</strong> ${assinatura}</p>`;

    const canvas = await html2canvas(document.querySelector("#orcamento"), { scale: 0.7 });

    // Restaura inputs para continuar edi√ß√£o
    const tbody = document.getElementById('listaItens');
    const linhas = tbody.querySelectorAll('tr');
    linhas.forEach(linha => {
      const qtd = linha.children[0].innerText;
      const desc = linha.children[1].innerText;
      const val = linha.children[2].innerText;

      linha.children[0].innerHTML = `<input type="number" value="${qtd}" min="1" onchange="calcularTotal()">`;
      linha.children[1].innerHTML = `<input type="text" placeholder="Descri√ß√£o" value="${desc}">`;
      linha.children[2].innerHTML = `<input type="number" value="${val}" min="0" onchange="calcularTotal()">`;
      calcularTotal();
    });

    // Restaura campos extras para input
    const infoCliente = document.querySelector('.info.cliente');
    infoCliente.innerHTML = `
      <input type="text" placeholder="Nome da Cliente" id="cliente" value="${document.querySelector('.info.cliente p strong') ? document.querySelector('.info.cliente p strong').parentElement.textContent.replace(/.*?:/, '').trim() : ''}">
      <input type="text" placeholder="CNPJ / CPF" id="cnpj" value="${document.querySelector('.info.cliente p strong:nth-child(2)') ? document.querySelector('.info.cliente p strong:nth-child(2)').parentElement.textContent.replace(/.*?:/, '').trim() : ''}">
      <input type="text" placeholder="Endere√ßo" id="endereco" value="${document.querySelector('.info.cliente p strong:nth-child(3)') ? document.querySelector('.info.cliente p strong:nth-child(3)').parentElement.textContent.replace(/.*?:/, '').trim() : ''}">
      <input type="text" placeholder="Telefone / WhatsApp" id="telefone" value="${document.querySelector('.info.cliente p strong:nth-child(4)') ? document.querySelector('.info.cliente p strong:nth-child(4)').parentElement.textContent.replace(/.*?:/, '').trim() : ''}">
    `;

    const infoVeiculo = document.querySelector('.info.veiculo');
    infoVeiculo.innerHTML = `
      <input type="text" placeholder="Cor" id="cor" value="${document.querySelector('.info.veiculo p strong') ? document.querySelector('.info.veiculo p strong').parentElement.textContent.replace(/.*?:/, '').trim() : ''}">
      <input type="text" placeholder="Modelo" id="modelo" value="${document.querySelector('.info.veiculo p strong:nth-child(2)') ? document.querySelector('.info.veiculo p strong:nth-child(2)').parentElement.textContent.replace(/.*?:/, '').trim() : ''}">
      <input type="text" placeholder="Placa" id="placa" value="${document.querySelector('.info.veiculo p strong:nth-child(3)') ? document.querySelector('.info.veiculo p strong:nth-child(3)').parentElement.textContent.replace(/.*?:/, '').trim() : ''}">
    `;

    assinaturaWrapper.innerHTML = `<input type="text" id="assinatura" placeholder="Assinatura do Respons√°vel" value="${assinatura}">`;

    document.getElementById('previewImage').src = canvas.toDataURL("image/jpeg");

    document.getElementById('orcamento').classList.add('hidden');
    document.getElementById('preview').classList.remove('hidden');
  }

  function voltarEdicao() {
    document.getElementById('preview').classList.add('hidden');
    document.getElementById('orcamento').classList.remove('hidden');
    document.getElementById('controles').classList.remove('hidden');
    document.querySelector('.controls button[onclick="adicionarItem()"]').classList.remove('hidden');
    document.querySelectorAll('.botao-coluna, .botao-coluna button').forEach(el => el.classList.remove('hidden'));
  }

  function baixarImagem() {
    const link = document.createElement('a');
    link.download = 'orcamento-elitecar.jpg';
    link.href = document.getElementById('previewImage').src;
    link.click();
  }

  async function compartilharOrcamento() {
    const img = document.getElementById('previewImage');

    if (!navigator.canShare || !navigator.canShare({ files: [] })) {
      alert('Este navegador n√£o suporta compartilhamento de arquivos.');
      return;
    }

    try {
      const response = await fetch(img.src);
      const blob = await response.blob();
      const file = new File([blob], 'orcamento.jpg', { type: 'image/jpeg' });

      await navigator.share({
        files: [file],
        title: 'Or√ßamento Elite Car',
        text: 'Confira o or√ßamento gerado pela Elite Car.',
      });
    } catch (err) {
      alert('Erro ao compartilhar: ' + err);
    }
  }

  atualizarDataHora();
  adicionarItem();
  calcularTotal();

</script>

</body>
</html>
